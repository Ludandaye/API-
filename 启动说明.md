# 智能对话系统启动说明

## 🚀 快速启动

### 方法1：使用启动脚本（推荐）
```bash
python start_server.py
```

### 方法2：直接启动
```bash
python app.py
```

## 📱 访问地址

启动成功后，在浏览器中访问：
- **主页**: http://localhost:5001
- **登录**: http://localhost:5001/login
- **注册**: http://localhost:5001/register

## 👤 默认账户

系统会自动创建以下默认账户：

### 管理员账户
- **用户名**: admin
- **密码**: admin123
- **权限**: 管理员权限，可以管理OpenAI API、用户、公告等

### 测试用户账户
- **用户名**: testuser
- **密码**: test123
- **权限**: 普通用户权限

## 🔧 端口问题解决

如果遇到端口被占用的问题：

1. **macOS用户**: 端口5000通常被AirPlay Receiver占用
   - 方案1：使用启动脚本自动选择可用端口
   - 方案2：在系统偏好设置中关闭AirPlay Receiver
   - 方案3：手动修改app.py中的端口号

2. **Windows/Linux用户**: 检查是否有其他应用占用端口
   ```bash
   # 查看端口占用
   netstat -ano | findstr :5000  # Windows
   lsof -i :5000                 # macOS/Linux
   ```

## 📋 功能说明

### 用户功能
- ✅ 用户注册/登录
- ✅ 智能对话（支持上下文记忆）
- ✅ 图像上传和分析
- ✅ 文件上传和处理
- ✅ 批量JSON数据处理
- ✅ Token管理和统计

### 管理员功能
- ✅ 管理OpenAI API配置
- ✅ 用户管理（编辑、删除、权限管理）
- ✅ 公告管理
- ✅ 系统配置管理
- ✅ 详细统计数据分析

## 📊 统计功能

### 概览统计
管理面板提供详细的系统统计信息：

1. **用户统计**
   - 总用户数、活跃用户数、管理员数量
   - 每日用户注册趋势图表

2. **对话统计**
   - 总对话数、本周新增对话数

3. **消息统计**
   - 总消息数、用户消息数、AI回复数
   - 每日消息发送趋势图表

4. **文件统计**
   - 总文件数、本周上传文件数

5. **Token统计**
   - 总Token余额、已使用Token、可用Token

6. **任务统计**
   - 总任务数、已完成任务、待处理任务

7. **最近活动**
   - 用户登录记录
   - 新对话创建记录
   - 文件上传记录

### 统计API
- `GET /api/admin/stats` - 获取完整统计数据
- 包含用户、对话、消息、文件、Token、任务等统计
- 提供最近7天的趋势数据
- 实时更新最近活动记录

## 👥 用户管理功能

### 管理员用户管理
1. **访问管理面板**: 登录管理员账户后访问 http://localhost:5002/admin
2. **用户列表**: 在"用户管理"标签页查看所有用户
3. **编辑用户**: 点击用户行的"编辑"按钮
   - 修改邮箱地址
   - 调整Token余额
   - 设置管理员权限
   - 启用/禁用用户账户
4. **删除用户**: 点击"删除"按钮（不可恢复）

### 用户管理API
- `GET /api/admin/users` - 获取用户列表
- `PUT /api/admin/users/<id>` - 编辑用户信息
- `DELETE /api/admin/users/<id>` - 删除用户

### 测试用户管理功能
```bash
python test_user_management.py
```

## 🛠️ 故障排除

### 1. 依赖安装问题
```bash
pip install -r requirements.txt
```

### 2. 数据库初始化
```bash
python init_db.py
```

### 3. API测试
```bash
python test_api.py
```

### 4. 常见错误
- **端口被占用**: 使用启动脚本或更换端口
- **模块导入错误**: 检查依赖安装
- **数据库错误**: 删除chat_system.db文件重新初始化

## 📞 技术支持

如果遇到问题，请检查：
1. Python版本是否为3.7+
2. 所有依赖是否正确安装
3. 端口是否被其他程序占用
4. 数据库文件权限是否正确

## 🔒 安全提醒

- 生产环境中请修改默认密码
- 定期备份数据库文件
- 配置HTTPS以提高安全性
- 设置强密码策略 